<% provide(:title, @user.name) %>
<div id="users">

<div class="row">
  <div class="col-md-offset-2 col-md-8">
    <div class="page-header">
      
      <div class="row">
        <div class="col-md-6">
          <h1><%= @user.name.titleize %></h1>
        </div>
        <div class="col-md-6 form-label-responsive">
          <!--%= render 'actions', :user => @user %-->

          <% if can? :manage, user %>
            <%= link_to 'Edit', edit_user_path(user) %>
                
            <% if !user.archived %>
              | &nbsp;<%= link_to 'Delete', @user, method: :delete, 
                data: { confirm: "Are you sure you want to delete #{user.name}?" } %>
              <% @prev_link = true %>
            <% end %>
          <% end %>

          <% if current_user.can_manage_team(user) %>
            <% if @prev_link %> |&nbsp; <% end %>
            <%= link_to 'Manage team', subordinates_user_path(user) %>
            <% @prev_link = true %>
          <% end %>

          <% if current_user.can_approve(user) %>
            <% if !user.approved? %>
              <% if @prev_link %> |&nbsp; <% end %>
              <%= link_to 'Authorize account', admin_approve_user_path(user), :remote => true, method: :post, data: { confirm: "Are you sure you want to approve #{user.name}'s account?" } %>
            <% else %>
              <% if @prev_link %> |&nbsp; <% end %>
              <%= link_to 'Suspend account', admin_unapprove_user_path(user), :remote => true, method: :post, data: { confirm: "Are you sure you want to unapprove #{user.name}'s account?" } %>
            <% end %>
            <% @prev_link = true %>
          <% end %>

        </div>
      </div>

    </div><!-- page header -->

    <div class="row">
      <div class="col-md-6">
        <% if @user.image %>
          <%= image_tag @user.image.file.url(:large), class: 'img-responsive', 
            alt: @user.image.file.url(:large) %>
        <% else %>
          <!-- placeholder image -->
          <%= image_tag "agent_soon.jpg", alt: "Agent image coming soon",
            class: 'img-responsive', width:"95%" %>
        <% end %>
        <br />
      </div><!-- col-md-6 -->

      <div class="col-md-6">
        <div class="row">
          <div class="col-md-12">

            <strong><%= @user.employee_title.display_name %>
            <% if @user.is_agent? %>
              <% @sp = @user.agent_specialties; if @sp.length > 0 %> 
                | <%= @sp.join(", ") %>
              <% end %>
            <% end %>
            </strong>
            <br/>
            <%= @user.company.name %> - <%= @user.office.name %> Office
          </div>
        </div>

        <% if @user.manager %>
          <div class="row">
            <div class="col-md-12">
              Manager: <%= link_to @user.manager.name, @user.manager %>

              <% if current_user.can_kick(user) %>
                <%= link_to '(Kick off team)', admin_kick_user_path(user), :remote => true, method: :post, data: { confirm: "Are you sure you want to kick #{user.name} off #{user.manager.name.titleize}'s team?" } %>
              <% end %> 
            </div>
          </div>
        <% end %>
        
        <div class="row">
          <div class="col-md-12">
          <strong>e &nbsp;|</strong> <%= @user.email %>
          </div>
        </div>

        <% if !@user.mobile_phone_number.empty? %>
          <div class="row">
            <div class="col-md-12">
              <strong>m |</strong> <%= @user.mobile_phone_number %>
            </div>
          </div>
        <% end %>

        <!-- ******** BIO ********** -->
        <% if @user.bio && !@user.bio.empty? %>
          <br />
          <div class="row">
            <div class="col-md-12">
              <strong class="form-label-responsive">Short Bio:</strong>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <%= @user.bio %>
            </div>
          </div>
        <% end %>

      </div>
    </div><!-- end top half -->

    

    <!-- ******** EMPLOYEES ********** -->
    <% if @user.subordinates.length > 0 %>
      <br />
      <div class="row">
        <div class="col-md-1">
          <p><strong class="form-label-responsive">Team</strong></p>
        </div>
        <div class="col-md-11">
          <div class="row">
            <% for i in 0..@user.subordinates.length-1 %>
            <% if i % 4 == 0 && i > 0 %>
                </div><div class="row">
              <% end %>
              <div class="col-md-3">
                <%= link_to @user.subordinates[i].name, @user.subordinates[i] %>
              </div>
              
            <% end %>
          </div>
        </div>
      </div><!-- row -->
    <% end %>

    <!-- *************** API TOKEN *************** -->
    <% if current_user.id == @user.id %>
      <br />
      <div class="row">
        <div class="col-md-12">
          <%= link_to 'Show API token', "#", class:'auth-token-toggle' %>
          <div class="auth-token hidden">
            <%= render partial: 'api_token', locals: {user: @user} %>
          </div>
        </div>
      </div>
    <% end %>

  </div><!-- main centering col -->
</div><!-- overall row -->


<div id="listings" data-search-path="<%= filter_listings_user_path %>">
  <%= render partial:'shared/listings', locals: { 
    model: @user, 
    residential_units: @residential_units, 
    res_images: @res_images,
    commercial_units: @commercial_units} %>
</div>


</div>