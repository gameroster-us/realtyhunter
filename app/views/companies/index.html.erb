<script>
  //call when typing or enter or focus leaving
  function initialize() {

    function doSearch(event) {
      $.ajax({
        url: "<%= filter_companies_path %>",
        data: {
          search_params: {
            name: $('#name').val()
          } 
        },
        dataType: "script"
      });
    };

    // search as user types
    var timer;
    function throttledSearch() {
      clearInterval(timer);  //clear any interval on key up
      timer = setTimeout(doSearch, 500);
    };
    
    // change enter key to tab
    function preventEnter(event) {
      if (event.keyCode == 13) {
        return false;
      }
    };

    $('input').keydown(preventEnter); 
    $('#name').keyup(throttledSearch);
  };

  $(document).ready(initialize);
</script>

<% provide(:title, 'Companies') %>
<div class="page-header">
  <div class="row">
    <div class="col-md-6">
      <h1>Companies</h1>
    </div>
    <div class="col-md-6 form-label-responsive">
      <%= link_to 'Add a Company', new_company_path %>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xs-12 col-md-6 vertical-padding">
    <%= form_tag companies_path, :method => 'get' do %>
      <%= label_tag(:name, "Filter:") %>
      <%= text_field_tag :name, params[:search], placeholder: "name", size: 50 %>
    <% end %>
  </div>
  <div class="hidden-xs hidden-sm col-md-offset-6 form-label-responsive">
    <%= will_paginate @companies %>
  </div>
</div>

<br />
<div class="row">
  <div class="col-md-12">

    <table class="table table-striped table-hover table-condensed table-responsive">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Name</th>
          <th># Offices</th>
          <th># Employees</th>
          <th colspan="1"></th>
        </tr>
      </thead>

      <tbody class="companies_table_body">
        <%= render @companies %>
      </tbody>
    </table>

  </div>
</div>

<div class="row">
  <div class="col-md-offset-6 form-label-responsive">
    <%= will_paginate @companies %>
  </div>
</div>
