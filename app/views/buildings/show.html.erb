<% provide(:title, @building.formatted_street_address) %>

<div id="buildings">
<div id="section-name" data-name="buildings">

<div class="row">
  <div class="col-md-8 col-md-offset-2">
		<div id="bldg_panel" class="panel panel-default">

		  <div class="panel-heading">
		  	<div class="panel-title">
			  	<div class="row">
		  			<div class="col-md-12 col-md-7">
		  				<h2 class="center">
		  					<%= @building.street_address %>
		  				</h2>
		  				<p class="center">
		  					<%= @building.active_unit_count %> available units on the market.
								<%= @building.total_unit_count %> total units.
							</p>
		  			</div>
		  		</div>
			  </div><!-- panel-title -->
			</div><!-- panel-heading -->

		  <div class="panel-body">
		  	<div class="row">
		  		<div class="col-xs-12 col-md-6 vertical-margin-lg">
		  			<%= link_to 'View all', buildings_path %>
						<% if current_user.is_management? || current_user.is_listings_manager? %>
							| <%= link_to 'Edit', edit_building_path(@building) %> |
							<%= link_to 'Add a Unit', new_residential_listing_path(building_id: @building.id) %>
						<% end %>
		  		</div>
		  		<div class="col-xs-12 col-md-6 form-label-responsive vertical-margin-lg">
		  			<%= link_to 'Report Inaccuracy', inaccuracy_modal_building_path(@building),
		  				class: "btn btn-sm btn-danger ",
			      	data: {toggle: "modal", target: "#bldgInaccuracyModal"}, remote: true %>
		  		</div>
		  	</div><!-- row -->

		  	<!-- begin photos -->
		  	<% if @building.images.any? %>

					<div id="building-carousel" class="carousel slide" data-ride="carousel" data-interval="false">
					  <!-- Wrapper for slides -->
					  <div class="carousel-inner" role="listbox">
					  	<% @building.images.each do |image| %>
					  		<div class="item">
						    	<%= image_tag image.file.url(:original), :class => 'img-responsive center-block',
						      	alt: image.file.url(:original) %>
						    </div>
					  	<% end %>
					  </div>

					  <!-- Controls -->
					  <a class="left carousel-control" href="#building-carousel" role="button" data-slide="prev">
					    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
					    <span class="sr-only">Previous</span>
					  </a>
					  <a class="right carousel-control" href="#building-carousel" role="button" data-slide="next">
					    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					    <span class="sr-only">Next</span>
					  </a>
					</div>

					<!-- clickable navigation -->
					<% if @building.images.length > 1 %>
						<% for i in 0..@building.images.length-1 %>
							<% image = @building.images[i] %>
				  		<a href="#building-carousel" data-slide-to="<%= i %>">
					      <%= image_tag image.file.url(:thumb), :class => 'photo-inline',
					      	alt: image.file.url(:thumb) %>
					    </a>
				  	<% end %>
				  <% end %>

			  <% else %>
			  	<!-- placeholder image -->
          <%= image_tag "listing_soon.png", alt: "Image coming soon",
          	:class => 'img-responsive center-block', width: "80%" %>
			  <% end %>
			  <!-- end photos -->

			  <br />
			  <div class="row">
			  	<div class="col-xs-12 col-xs-offset-1">
			  	<p>
					  <strong>Street Address:</strong>
					  <%= @building.formatted_street_address %>
					</p>

					<% if @building.neighborhood %>
						<p>
						  <strong>Neighborhood:</strong>
						  <%= @building.neighborhood.name %>
						</p>
					<% end %>

					<% if !@building.notes.blank? %>
						<p>
						  <strong>Building Notes:</strong>
						  <%= @building.notes %>
						</p>
					<% end %>

					<% if @building.landlord %>
						<p>
						  <strong>Landlord Code:</strong>
						  <% if current_user.is_management? %>
							  <%= link_to @building.landlord.code, landlord_path(@building.landlord) %>
							<% else %>
								<%= @building.landlord.code %>
							<% end %>
						</p>
					<% end %>

					<% if !@building.amenities_to_s.blank? %>
						<p>
						  <strong>Building-Level Amenities:</strong>
						  <%= @building.amenities_to_s %>
						</p>
					<% end %>

					<% if @building.rental_term %>
		        <p>
		        	<strong>Rental Terms:</strong>
		        	<% if @building.rental_term %>
		        		<%= @building.rental_term.name.titleize %>
		        	<% end %>
		        </p>
		      <% end %>

	        <% if @building.pet_policy %>
						<p>
		    			<strong>Pet Policy:</strong>
		    			<%= @building.pet_policy.name.titleize %>
						</p>
					<% end %>

					<% if !@building.utilities_to_s.blank? %>
						<p>
						  <strong>Utilities:</strong>
						  <%= @building.utilities_to_s %>
						</p>
					<% end %>

					<% if @building.landlord%>
						<!-- Broker's Fee -->
		        <p>
		    		<% if @building.landlord.has_fee %>
		    			<strong>Tenant Pays:</strong>
		    			<% if @building.landlord.tp_fee_percentage %>
			    			<%= @building.landlord.tp_fee_percentage %>%
			    		<% else %>
			    			(no amount specified)
			    		<% end %>

		    		<!-- No Broker's Fee -->
		    		<% else %>
		    			<strong>OP Pays:</strong>
		    			<% if @building.landlord.op_fee_percentage %>
			    			<%= @building.landlord.op_fee_percentage %>%
			    		<% else %>
			    			(no amount specified)
			    		<% end %>

		    		<% end %>
		    	<% end %>
	    		</p>

					<p>
					  <strong>Created:</strong>
					  <%= @building.created_at %>
					</p>
					<p>
					  <strong>Last Updated:</strong>
					  <%= @building.updated_at %>
					</p>
					<p>
					  <strong>Last Unit Updated:</strong>
					  <%= @building.last_unit_updated_at %>
					</p>

				</div>
			</div>

			<br />
    	<div class="row">
    		<div class="col-md-12">
					<iframe id="map-canvas"
					  frameborder="0"
					  src="https://www.google.com/maps/embed/v1/place?key=<%= ENV['GOOGLE_MAPS_KEY'] %>
					    &q=<%= @building.formatted_street_address %>"
					  allowfullscreen>
					</iframe>
				</div>
			</div>

		  </div>
		</div>

	</div>
</div>

<div id="listings" data-search-path="<%= filter_listings_building_path %>">
	<%= render partial:'shared/listings', locals: {
		model: @building,
		residential_units: @residential_units,
		res_images: @res_images,
		commercial_units: @commercial_units,
		com_images: @com_images
	} %>
</div>

<!-- Inaccuracy Modal -->
<div class="modal fade modal-fullscreen" id="bldgInaccuracyModal" tabindex="-1" role="dialog"
  aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Report Building Inaccuracy</h4>
      </div>
      <div id="placeholder-body"></div>

    </div>
  </div>
</div>

</div><!-- buildings -->
