<script>
	function initialize() {
    $(".panel").geocomplete({
    	map: "#map_canvas",
    	location: "<%= @building.formatted_street_address %>" ,
    	details: ".details"
    }).bind("geocode:result", function(event, result){
        //console.log(result);
    }).bind("geocode:error", function(event, result){
        //console.log("[ERROR]: " + result);
    });
	};
	$(document).ready(initialize);
</script>

<% provide(:title, @building.formatted_street_address) %>


<div class="row">
  <div class="col-md-6 col-md-offset-3">
  	<div class="page-header">
  		<div class="row">
  			<div class="col-md-12">
  				<h1><%= @building.street_address %></h1>
  			</div>
  		</div>
  		<div class="row">
  			<div class="col-md-7">
  				<p><%= @building.active_units.count %> available units on the market.
						<%= @building.units.count %> total units.
					</p>
  			</div>
  			<div class="col-md-5 right">
  				<%= link_to 'View all', buildings_path %> |
						<% if current_user.is_management? %>
							<%= link_to 'Edit', edit_building_path(@building) %> | 
							<%= link_to 'Add a Unit', new_residential_unit_path(building_id: @building.id) %> | 
						<% end %>
						<%= link_to 'Report Inaccuracy', inaccuracy_modal_building_path(@building), 
			      	data: {toggle: "modal", target: "#bldgInaccuracyModal"}, remote: true %>
  			</div>
  		</div>
		</div>

		<div class="panel panel-default">
		  <div class="panel-heading">
		    <h3 class="panel-title">Basic Details</h3>
		  </div>
		  <div class="panel-body">
		  	<!-- begin photos -->
		  	<% if @building.images.any? %>
					<div id="building-carousel" class="carousel slide" data-ride="carousel">
					  <!-- Indicators -->
					  <ol class="carousel-indicators">
						  <% for i in 0..@building.images.length-1 %>
						  	<li data-target="#building-carousel" data-slide-to="<%= i %>"></li>
						  <% end %>
					  </ol>

					  <!-- Wrapper for slides -->
					  <div class="carousel-inner" role="listbox">
					  	<% @building.images.each do |image| %>	
					  		<div class="item">
						      <%= image_tag image.file.url(:medium), :class => 'img-responsive center-block', alt: image.file.url(:medium) %>
						    </div>
					  	<% end %>
					  </div>

					  <!-- Controls -->
					  <a class="left carousel-control" href="#building-carousel" role="button" data-slide="prev">
					    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
					    <span class="sr-only">Previous</span>
					  </a>
					  <a class="right carousel-control" href="#building-carousel" role="button" data-slide="next">
					    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					    <span class="sr-only">Next</span>
					  </a>
					</div>

			  <% else %>
			  	<p>No images added yet.</p>
			  <% end %>
			  <!-- end photos -->

		  	<div id="map_canvas"></div>
		  	<br />
		    <p>
				  <strong>Street Address:</strong>
				  <%= @building.formatted_street_address %>
				</p>
				
				<p>
				  <strong>Neighborhood:</strong>
				  <%= @building.neighborhood.name %>
				</p>

				<p>
				  <strong>Building Notes:</strong>
				  <%= @building.notes %>
				</p>

				<p>
				  <strong>Landlord Code:</strong>
				  <% if current_user.is_management? %>
					  <%= link_to @building.landlord.code, landlord_path(@building.landlord) %>
					<% else %>
						<%= @building.landlord.code %>
					<% end %>
				</p>

				<p>
				  <strong>Building-Level Amenities:</strong>
				  <%= @building.amenities_to_s %>
				</p>

        <p>
        	<strong>Required securities:</strong> <%= @building.required_security.name.titleize %>
        </p>

				<p>
    			<strong>Pet Policy:</strong>
    			<%= @building.pet_policy.name.titleize %>
				</p>
				<p>
				  <strong>Rental Terms:</strong>
				  <%= @building.rental_terms_to_s %>
				</p>

				<p>
				  <strong>Created:</strong>
				  <%= @building.created_at.strftime("%b %e, %Y") %>
				</p>
				<p>
				  <strong>Last Updated:</strong>
				  <%= @building.updated_at.strftime("%b %e, %Y") %>
				</p>
				<p>
				  <strong>Last Unit Updated:</strong>
				  <%= @building.last_unit_updated %>
				</p>
		  </div>
		</div>

	</div>
</div>


<!-- Inaccuracy Modal -->
<div class="modal fade" id="bldgInaccuracyModal" tabindex="-1" role="dialog" 
  aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Report Building Inaccuracy</h4>
      </div>
      <div id="placeholder-body"></div>

    </div>
  </div>
</div>


<!-- ******** LISTINGS ********** -->
<br />
<div class="row">
  <div class="col-md-12">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <% if @building.residential_units.length > 0 %>
        <li role="residential-listings" class="active"><a href="#residential-listings" 
          aria-controls="residential-listings" role="tab" data-toggle="tab">Residential</a></li>
      <% end %>
      <% if @building.commercial_units.length > 0 %>
        <li role="commercial-listings"><a href="#commercial-listings" aria-controls="commercial-listings" 
          role="tab" data-toggle="tab">Commercial</a></li>
      <% end %>
    </ul>

    <div class="tab-content">
      <!-- ******************** first tabpanel - residential ********************-->
      <% if @building.residential_units.length > 0 %>
        <div role="tabpanel" class="tab-pane fade in active" id="residential-listings">
          <%= render partial:'residential_units/table', locals: { residential_units: @building.residential_units} %>
        </div>
      <% end %>
      <!-- ******************** second tabpanel - commercial ********************-->
      <% if @building.commercial_units.length > 0 %>
        <div role="tabpanel" class="tab-pane fade" id="commercial-listings">
          <!--%= render partial:'commercial_units/table', locals: { residential_units: @building.commercial_units} %-->
        </div>
      <% end %>
    </div>

  </div><!-- col -->
</div><!-- row -->
