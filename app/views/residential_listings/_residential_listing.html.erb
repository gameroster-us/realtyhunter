  <tr class="<%= cycle('even', 'odd') -%>" data-id="<%= residential_listing.listing_id %>" >

    <!-- ****** checkboxes ****************************************** -->
    <% if controller_name == 'residential_listings' %>
      <td>
        <i data-action="selectUnit" class="fa fa-square-o fa-lg"></i>
      </td>
    <% end %>

    <!-- ****** IMAGE ****************************************** -->
    <td class="img-col">
      <!-- display building image first, if any are found -->
      <% if bldg_images[residential_listing.building_id] %>
        <%= link_to(image_tag(bldg_images[residential_listing.building_id],
            alt: bldg_images[residential_listing.building_id]), residential_listing) %>
      <!-- otherwise, pick the first residential photo -->
      <% elsif res_images[residential_listing.unit_id] %>
        <%= link_to(image_tag(res_images[residential_listing.unit_id],
            alt: res_images[residential_listing.unit_id]), residential_listing) %>
      <% else %>
        <!-- otherwise, fall back on placeholder image -->
        <%= link_to(image_tag("listing_soon_thumb.png".freeze, alt: "Image coming soon",
            class: 'img-responsive',
            size: "100x100"), residential_listing) %>
      <% end %>
    </td>

    <!-- ****** ADDRESS ****************************************** -->
    <td>
      <%= link_to "#{residential_listing.street_address}".freeze, residential_listing_path(residential_listing.id) %><br />
      <% if residential_listing.neighborhood_name %>
        <small><%= residential_listing.neighborhood_name %></small>
      <% end %>
    </td>

    <!-- ****** UNIT ****************************************** -->
    <td>
      <%= residential_listing.building_unit %>
      <% if residential_listing.can_roomshare %>
        <br /><strong>(RS)</strong>
      <% end %>
    </td>

    <!-- ****** BEDS/BATHS ****************************************** -->
    <td>
      <%= beds_as_str(residential_listing) %> / <%= baths_as_str(residential_listing) %>
    </td>

    <!-- ****** PRICE ****************************************** -->
    <td><%= rent_formatted(residential_listing.rent) %></td>

    <!-- ****** AVAILBLE_BY ****************************************** -->
    <td>
      <% if residential_listing.available_by %>
        <%= residential_listing.available_by.strftime("%b %d") %>
      <% else %>
        -
      <% end %>
    </td>

    <!-- ****** ACCESS ****************************************** -->
    <td class="access-info" data-toggle="tooltip" data-placement="top" title="<%= residential_listing.access_info %>"
      data-delay="1500">
      <div class="row">
        <div class="col-md-12 js-phoneNumber">
          <%= trim_access residential_listing.access_info %>
        </div>
      </div>

      <!-- if roomsharing, draw indicators for each roommate slot here -->
      <% if residential_listing.can_roomshare %>
        <div class="row">
          <div class="col-md-12 margin-vertical">
            <% for idx in 0..residential_listing.beds-1 %>

              <!-- if the roommate exists -->
              <% if idx < residential_listing.roommates.count && residential_listing.roommates[idx] %>
                <% roommate = residential_listing.roommates[idx] %>
                <% if roommate.upload_picture_of_yourself %>
                  <%= image_tag roommate.upload_picture_of_yourself, class: 'roommate_icon',
                    alt: roommate.upload_picture_of_yourself, size:'26x26' %>
                <% else %>
                  <!-- otherwise the roommate is valid but has no photo -->
                  <div class="roommate_no_photo_icon">
                    <%= roommate.initials %>
                  </div>
                <% end %>

              <% else %>
                <!-- if there's no roommate -->
                <div class="roommate_no_photo_icon">&nbsp;&nbsp;&nbsp;</div>
              <% end %>

            <% end %>
            <br />
          </div>
        </div>
      <% end %><!-- roomsharing icons -->
    </td>

    <!-- ****** LANDLORD ****************************************** -->
    <td>
      <% if current_user.is_management? %>
        <%= link_to residential_listing.code, landlord_path(residential_listing.landlord_id) %>
      <% else %>
        <%= residential_listing.code %>
      <% end %>
    </td>

    <!-- ****** PRIMARY AGENT ****************************************** -->
    <td>
      <% if residential_listing.name %>
        <%# abort residential_listing.name.inspect %>
        <%= link_to residential_listing.name, user_path(residential_listing.primary_agent_id) %>
      <% else %>
        --
      <% end %>
    </td>

    <!-- ****** StreetEasy PRIMARY AGENT ****************************************** -->
    <td>
      <% if !residential_listing.unit.streeteasy_primary_agent_id.nil? %>
        <%= link_to User.find(residential_listing.unit.streeteasy_primary_agent_id).name, user_path(residential_listing.unit.streeteasy_primary_agent_id) %>
      <% else %>
        --
      <% end %>
    </td>

    <!-- ****** UPDATED_AT ****************************************** -->
    <td><%= time_ago_in_words(residential_listing.updated_at) %></td>

    <td>
      <% if residential_listing.unit.audits %>
        <%# abort residential_listing.unit.audits.inspect %>
        <% residential_listing.unit.audits.each do |audit| %>
          <% if audit.audited_changes["rent"] %>
            <% @disp_date = audit.created_at.strftime("%b-%d-%Y") %>
          <% end %>
        <% end %>
        <%= @disp_date %>
      <% end %>

    </td>
    <!-- ****** STATUS ****************************************** -->
    <td>
      <% if residential_listing.status == Unit.statuses["active"] %>
        <span class="glyphicon glyphicon-arrow-up green" aria-hidden="true"></span>
      <% elsif residential_listing.status == Unit.statuses["pending"] %>
        <span class="glyphicon glyphicon-arrow-up dark-orange" aria-hidden="true"></span>
      <% elsif residential_listing.status == Unit.statuses["off"] %>
        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
      <% end %>
    </td>

    <!-- ****** LINKS ****************************************** -->
    <%# abort residential_listing.streeteasy_flag.inspect %>
    <%# if current_user.is_streeteasy_agent? && residential_listing.status == Unit.statuses["active"] && residential_listing.streeteasy_flag == false %>
      <%# if residential_listing.streeteasy_flag_one != true %>
       <!--  <td><%#= link_to "Active StreetEasy", streeteasy_active_by_agent_path(residential_listing, 'true') %></td>
      <%# else %>
        <td><%#= link_to "Deactive StreetEasy", streeteasy_active_by_agent_path(residential_listing, 'false') %></td> -->
      <%# end %>
    <%# end %>
    <% if current_user.is_management? ||
          current_user.is_listings_manager? ||
          current_user.is_photo_manager? %>
      <td class="hidden-print">
        <% if !current_user.is_photo_manager? %>
          <%= link_to 'Edit', edit_residential_listing_path(residential_listing) %>
          <br>
          <% if controller_name == 'residential_listings' %>
            <%= link_to 'Delete', delete_modal_residential_listing_path(residential_listing),
              data: { toggle: "modal", target: "#runitDeleteModal", params: params}, remote: true %>
            <br>
          <% else %>
            <%= link_to 'Delete', delete_residential_listing_modal_building_path(
              id: residential_listing.unit.building.id, listing_id: residential_listing),
              data: { toggle: "modal", target: "#runitDeleteModal", params: params}, remote: true %>
            <br>
          <% end %>
          <!-- hide the delete link on landlord and user pages -->
          <%= link_to 'Duplicate', duplicate_modal_residential_listing_path(residential_listing),
            data: { toggle: "modal", target: "#runitDuplicateModal"}, remote: true %>
        <% else %>
          <%= link_to 'Manage Photos', edit_residential_listing_path(residential_listing) %>
        <% end %>
      </td>
    <% end %>
  </tr>
