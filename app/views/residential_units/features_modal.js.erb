$('#featuresModal #placeholder-body').html("<%= j(render :partial => "features_modal_helper", locals: { unit_amenities: @unit_amenities, building_amenities: @building_amenities }) %>");

// remember the last selected features
var ids = $('#unit_feature_ids').val().split(", ");
if (ids != "{:id=>\"unit_feature_ids\"}") {
	$.each(ids, function(idx, val) {
		console.log('1', val)
		$('#'+ val).toggleClass('active');
	});
}
var ids = $('#building_feature_ids').val().split(", ");
if (ids != "{:id=>\"building_feature_ids\"}") {
	$.each(ids, function(idx, val) {
		console.log('2', val)
		$('#'+ val).toggleClass('active');
	});
}

// feed info back to search form
$('#featuresModal .btn-close').click( function(event) {
	var selectedFeatures = [];
	var selectedUnitIds = [];
	var selectedBuildingIds = [];
	
	$(".unit-feature-buttons .active").each(function(idx, val) {
		selectedFeatures.push($(val).attr('name'));
		selectedUnitIds.push(val.id);
	});
	$(".building-feature-buttons .active").each(function(idx, val) {
		selectedFeatures.push($(val).attr('name'));
		selectedBuildingIds.push(val.id);
	});

	$('#selected_features').html(selectedFeatures.join(", "));
	$('#unit_feature_ids').val(selectedUnitIds.join(", "));
	$('#unit_feature_ids').trigger('change');
	$('#building_feature_ids').val(selectedBuildingIds.join(", "));
	$('#building_feature_ids').trigger('change');
});